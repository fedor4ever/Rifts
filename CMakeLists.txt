cmake_minimum_required(VERSION 3.10)

project(6r49 NONE)

set(RIFTS_DIR     ${CMAKE_CURRENT_SOURCE_DIR}/Rifts)
set(RELEASE_DIR   ${CMAKE_CURRENT_SOURCE_DIR}/Release)

set(SRC_DIR       ${RIFTS_DIR}/Code/src)
set(STUB_DIR      ${CMAKE_CURRENT_SOURCE_DIR}/Stubs)
set(SDK_ROOT      ${CMAKE_CURRENT_SOURCE_DIR}/Symbian/6.1)
set(EPOC_PLATFORM ${SDK_ROOT}/Shared/EPOC32)
set(GCC_BIN_PATH  ${EPOC_PLATFORM}/gcc/bin)

set(INCLUDE_DIRS  -I${EPOC_PLATFORM}/include -I${SDK_ROOT}/Series60/Epoc32/Include -I${SDK_ROOT}/Series60/Epoc32/Include/libc  -I${STUB_DIR} -I${SRC_DIR} -I${SRC_DIR}/Main -I${RIFTS_DIR}/Prototype/NokiaRasterizer/App32/LIB/INC)

set(GCC_COMN_DEFS -D__SYMBIAN32__ -D__GCC32__ -D__EPOC32__ -D__MARM__ -D__MARM_ARMI__ -D__DLL__)
set(GCC_FLAGS     -march=armv4t -mthumb-interwork -pipe -c -nostdinc -Wall -Wno-ctor-dtor-privacy -Wno-unknown-pragmas  -Wno-switch -mstructure-size-boundary=8)
set(GCC_MODE_DEFS -DNDEBUG -D_UNICODE)
set(GCC_USER_DEFS -DUID1=0x10000079 -DUID2=0x100039CE -DUID3=0x101FD3F2)
set(GCC_RUN_COM   ${GCC_BIN_PATH}/gcc -s -fomit-frame-pointer -O ${GCC_FLAGS} ${GCC_COMN_DEFS} ${GCC_MODE_DEFS} ${GCC_USER_DEFS})

set(OBJ_LIST "")

macro(copy_file file source_dir dest_dir)
    message("Copying ${file} to ${dest_dir}")
    configure_file(${RIFTS_DIR}/Code/data/${source_dir}/${file} ${RELEASE_DIR}/${dest_dir}/${file} COPYONLY)
endmacro()

macro(add_source sub_dir source)
    get_filename_component(base_name ${source} NAME_WLE)

    add_custom_target(
        ${base_name}.o
        ALL
        COMMAND
        ${GCC_RUN_COM} -c ${INCLUDE_DIRS} -o ${CMAKE_CURRENT_BINARY_DIR}/${base_name}.o ${SRC_DIR}/${sub_dir}/${source}
        SOURCES
        ${SRC_DIR}/${sub_dir}/${source}
        WORKING_DIRECTORY
        ${GCC_BIN_PATH})

    list(APPEND OBJ_LIST ${CMAKE_CURRENT_BINARY_DIR}/${base_name}.o)
endmacro()

macro(add_stub source)
    get_filename_component(base_name ${source} NAME_WLE)

    add_custom_target(
        ${base_name}.o
        ALL
        COMMAND
        ${GCC_RUN_COM} -c ${INCLUDE_DIRS} -o ${CMAKE_CURRENT_BINARY_DIR}/${base_name}.o ${STUB_DIR}/${source}
        SOURCES
        ${STUB_DIR}/${source}
        WORKING_DIRECTORY
        ${GCC_BIN_PATH})
endmacro()

macro(build_library)
    add_custom_target(
        ${PROJECT_NAME}.in
        ALL
        COMMAND
        ${GCC_BIN_PATH}/ar r ${CMAKE_CURRENT_BINARY_DIR}/${PROJECT_NAME}.in ${OBJ_LIST}
        WORKING_DIRECTORY
        ${GCC_BIN_PATH})
endmacro()

macro(build_dll)

endmacro()

#copy_file(6R49.cfg  "." "system/apps/6r49/")
#copy_file(6R49F.cfg "." "system/apps/6r49/")
#copy_file(6R49G.cfg "." "system/apps/6r49/")
#copy_file(6R49I.cfg "." "system/apps/6r49/")
#copy_file(6R49S.cfg "." "system/apps/6r49/")

#copy_file(6R49.AIF          "ExtraData" "system/apps/6r49/")
#copy_file(crisp_8.ngf       "ExtraData" "system/apps/6r49/")
#copy_file(crisp_64.ngf      "ExtraData" "system/apps/6r49/")
#copy_file(crisp_Heading.ngf "ExtraData" "system/apps/6r49/")
#copy_file(version.txt       "ExtraData" "system/apps/6r49/")

add_source("." BuildVersion.cpp)
add_source("." common.cpp)
add_source("." memory.cpp)
add_source("Ai" AIHelperClasses.cpp)
add_source("Ai" AIHelpers.cpp)
add_source("Ai" AIPath.cpp)
add_source("Ai" CrazyAI.cpp)
add_source("Ai" FearAI.cpp)
add_source("Ai" IAIModule.cpp)
add_source("Ai" IPlayableAI.cpp)
add_source("Ai" NPCAI.cpp)
add_source("Ai" NPCCombatAI.cpp)
add_source("Ai" NPCCombatAITargeter.cpp)
add_source("Ai" PCAI.cpp)
add_source("Ai" PCCombatAI.cpp)
add_source("Ai" PCCombatAISelectionState.cpp)
add_source("Ai" PropAI.cpp)
#add_source("Ai" RemoteAI.cpp)
add_source("Ai" RemoteCombatAI.cpp)
add_source("Ai" ScriptCombatAI.cpp)
add_source("Ai" WallAI.cpp)
add_source("Data" DBObjects.cpp)
add_source("Data" DataID.cpp)
add_source("Data" DataList.cpp)
add_source("Data" DatabaseManager.cpp)
add_source("Data" ElementDataResource.cpp)
add_source("Data" EntityDataNPC.cpp)
add_source("Data" EntityDataPC.cpp)
add_source("Data" EntityDataProp.cpp)
add_source("Data" EntityDataResource.cpp)
add_source("Data" IDataObject.cpp)
add_source("Data" IElementData.cpp)
add_source("Data" IElementDataItem.cpp)
add_source("Data" IEntityData.cpp)
add_source("Data" IEntityDataActor.cpp)
add_source("Data" ImportParty.cpp)
add_source("Data" InfoChunk.cpp)
add_source("Data" InfoGroup.cpp)
add_source("Data" LootManager.cpp)
add_source("Data" MapData.cpp)
add_source("Data" MapDataResource.cpp)
add_source("Data" StatTracker.cpp)
add_source("Data" StoreDataResource.cpp)
add_source("Entities" BossEntity.cpp)
add_source("Entities" CameraEntity.cpp)
add_source("Fonts" FontDescriptor.cpp)
add_source("Fonts" SpriteUnitString.cpp)
add_source("Fonts" SpriteUnitString2.cpp)
add_source("Fonts" TextFillBox.cpp)
add_source("FrontEnd" 2DWidget.cpp)
add_source("FrontEnd" AttributeModCore.cpp)
add_source("FrontEnd" ClassSelectionCore.cpp)
add_source("FrontEnd" DialogueWidget.cpp)
add_source("FrontEnd" EntityInfoBox.cpp)
#add_source("FrontEnd" FrontEndCore.cpp)
add_source("FrontEnd" HUDManager.cpp)
add_source("FrontEnd" ItemMenuWidget.cpp)
add_source("FrontEnd" MenuWidget.cpp)
#add_source("FrontEnd" NameGenCore.cpp)
add_source("FrontEnd" SkillSelectionCore.cpp)
add_source("FrontEnd" SpellSelectionCore.cpp)
add_source("Game" GameManager.cpp)
add_source("Game/Actions" AOETileEffectAction.cpp)
add_source("Game/Actions" Action.cpp)
add_source("Game/Actions" AirRaidAction.cpp)
add_source("Game/Actions" AnimationAction.cpp)
add_source("Game/Actions" CameraAction.cpp)
add_source("Game/Actions" CharacterAction.cpp)
add_source("Game/Actions" CharacterTextAction.cpp)
add_source("Game/Actions" CombatTriggerAction.cpp)
add_source("Game/Actions" CutsceneAction.cpp)
add_source("Game/Actions" DeathWordAction.cpp)
add_source("Game/Actions" DialogueAction.cpp)
add_source("Game/Actions" EnterDoorAction.cpp)
add_source("Game/Actions" FaceTileAction.cpp)
add_source("Game/Actions" FallAction.cpp)
add_source("Game/Actions" FireQuakeAction.cpp)
add_source("Game/Actions" FireSpongeAction.cpp)
add_source("Game/Actions" FlyAction.cpp)
add_source("Game/Actions" FrontEndAction.cpp)
add_source("Game/Actions" FullScreenAnimationAction.cpp)
add_source("Game/Actions" JumpAction.cpp)
add_source("Game/Actions" JumpDownAction.cpp)
add_source("Game/Actions" KnockbackAction.cpp)
add_source("Game/Actions" KnockupAction.cpp)
add_source("Game/Actions" MeteorStrikeAction.cpp)
add_source("Game/Actions" MoveAction.cpp)
add_source("Game/Actions" MoveEntityGraphicsAction.cpp)
add_source("Game/Actions" ParticleAction.cpp)
add_source("Game/Actions" PhoenixAction.cpp)
add_source("Game/Actions" PlagueAction.cpp)
add_source("Game/Actions" PlayAnimationAction.cpp)
add_source("Game/Actions" PlayEffectAction.cpp)
add_source("Game/Actions" PossessAction.cpp)
add_source("Game/Actions" ProjectileAction.cpp)
add_source("Game/Actions" ProjectileLaserAction.cpp)
add_source("Game/Actions" ProjectileTailAction.cpp)
add_source("Game/Actions" ShakeEntityAction.cpp)
add_source("Game/Actions" SummonAction.cpp)
add_source("Game/Actions" TelemechanicAction.cpp)
add_source("Game/Actions" TidalWaveAction.cpp)
add_source("Game/Actions" TophetAttackAction.cpp)
add_source("Game/Actions" TophetKnockbackAction.cpp)
add_source("Game/Actions" TornadoAction.cpp)
add_source("Game/Actions" WorldColorAction.cpp)
add_source("Game/CombatManager" CombatCallbacks.cpp)
add_source("Game/CombatManager" CombatManager.cpp)
add_source("Game/CombatManager" CombatManagerDamage.cpp)
add_source("Game/CombatManager" CombatManagerImpl.cpp)
add_source("Game/CombatManager" CombatManagerStrings.cpp)
add_source("Game/CombatManager" ElementHelpers.cpp)
add_source("Game/CombatManager" ElementReference.cpp)
add_source("Game/Cores" AbilitiesMenuCore.cpp)
add_source("Game/Cores" ArenaCharacterSelect.cpp)
add_source("Game/Cores" ArenaCore.cpp)
add_source("Game/Cores" ArenaGameCore.cpp)
add_source("Game/Cores" ArenaGameLoader.cpp)
add_source("Game/Cores" ArenaGameOptions.cpp)
add_source("Game/Cores" ArenaGameSearch.cpp)
add_source("Game/Cores" ArenaGameView.cpp)
add_source("Game/Cores" ArenaMainMenu.cpp)
#add_source("Game/Cores" ArenaNameGenCore.cpp)
add_source("Game/Cores" ArenaTurnCore.cpp)
#add_source("Game/Cores" BTGameMenuCore.cpp)
#add_source("Game/Cores" BTHostMenuCore.cpp)
#add_source("Game/Cores" BluetoothConnectionCore.cpp)
#add_source("Game/Cores" BluetoothCore.cpp)
#add_source("Game/Cores" BluetoothGameCore.cpp)
#add_source("Game/Cores" CheatEnablerCore.cpp)
add_source("Game/Cores" ChopShopCore.cpp)
add_source("Game/Cores" CityMapCore.cpp)
add_source("Game/Cores" CoreManager.cpp)
add_source("Game/Cores" CutsceneCore.cpp)
add_source("Game/Cores" DeleteGameCore.cpp)
add_source("Game/Cores" EquipmentMenuCore.cpp)
add_source("Game/Cores" FeaturesCore.cpp)
add_source("Game/Cores" GameCore.cpp)
add_source("Game/Cores" GameFileCore.cpp)
add_source("Game/Cores" ImageBrowserCore.cpp)
add_source("Game/Cores" InnCore.cpp)
add_source("Game/Cores" KeyMapMenuCore.cpp)
add_source("Game/Cores" LimitedPauseMenuCore.cpp)
add_source("Game/Cores" LoadGameCore.cpp)
add_source("Game/Cores" MapCore.cpp)
add_source("Game/Cores" MultiplayerGameCore.cpp)
add_source("Game/Cores" OptionsMenuCore.cpp)
add_source("Game/Cores" PartyMenuCore.cpp)
add_source("Game/Cores" PauseMenuCore.cpp)
add_source("Game/Cores" PickUpMenuCore.cpp)
add_source("Game/Cores" QuestMenuCore.cpp)
#add_source("Game/Cores" ReconnectionCore.cpp)
add_source("Game/Cores" RewardScreenCore.cpp)
#add_source("Game/Cores" SaveGameCore.cpp)
add_source("Game/Cores" ServerActionCore.cpp)
add_source("Game/Cores" SettingsMenuCore.cpp)
add_source("Game/Cores" SinglePlayerGameCore.cpp)
add_source("Game/Cores" SplashCore.cpp)
add_source("Game/Cores" StoreCore.cpp)
add_source("Game/Cores" UnlockablesCore.cpp)
add_source("Game/PersistentEffects" IPersistentEffect.cpp)
add_source("Game/PersistentEffects" PersistentControl.cpp)
add_source("Game/PersistentEffects" PersistentCrazy.cpp)
add_source("Game/PersistentEffects" PersistentHorror.cpp)
add_source("Game/PersistentEffects" PersistentStats.cpp)
add_source("Game/PersistentEffects" PersistentSummon.cpp)
add_source("Game/PersistentEffects" PersistentTrigger.cpp)
add_source("Game/Quests" Quest.cpp)
add_source("Game/Quests" QuestControl.cpp)
add_source("Game/Quests" Quests.cpp)
add_source("Game/Sector" DynamicTile.cpp)
add_source("Game/Sector" DynamicTileStrip.cpp)
add_source("Game/Sector" LeyLineManager.cpp)
add_source("Game/Sector" RangeMaker.cpp)
add_source("Game/Sector" SectorData.cpp)
add_source("Game/Sector" SectorListResource.cpp)
add_source("Game/Sector" SectorModule.cpp)
add_source("Game/Sector" SectorModuleLineOfSight.cpp)
add_source("Game/Sector" SectorModuleMovement.cpp)
add_source("Game/Sector" SectorRegion.cpp)
add_source("Game/Sector" SectorResource.cpp)
add_source("Game/Sector/AStar" PathFinder.cpp)
add_source("Game/Sequencer" ActionOpCode.cpp)
add_source("Game/Sequencer" CreateAction.cpp)
add_source("Game/Sequencer" DebugLink.cpp)
add_source("Game/Sequencer" DisAsm.cpp)
add_source("Game/Sequencer" SequenceFunctions.cpp)
add_source("Game/Sequencer" SequenceHelpers.cpp)
add_source("Game/Sequencer" SequenceOpCodes.cpp)
add_source("Game/Sequencer" SequenceResource.cpp)
add_source("Game/Sequencer" Sequencer.cpp)
add_source("Game/Sequencer" SequencerAction.cpp)
add_source("Game/Triggers" CombatTrigger.cpp)
add_source("Game/Triggers" StaticTrigger.cpp)
add_source("Game/Triggers" TriggerScript.cpp)
add_source("Input" CodeRecognizer.cpp)
add_source("Input" IInputListener.cpp)
add_source("Input" InputManager.cpp)
add_source("Main" ActorEntity.cpp)
add_source("Main" BBLog.cpp)
add_source("Main" BBLogCommon.cpp)
add_source("Main" CombatEntity.cpp)
add_source("Main" GlobalSettings.cpp)
#add_source("Main" Globals.cpp)
add_source("Main" HashedStringIndex.cpp)
add_source("Main" IBaseCore.cpp)
add_source("Main" IMainObject.cpp)
add_source("Main" Inventory.cpp)
add_source("Main" MainElement.cpp)
add_source("Main" MainEntity.cpp)
add_source("Main" PartyData.cpp)
add_source("Main" PropEntity.cpp)
add_source("Main" StarterCore.cpp)
add_source("Main" Unlockables.cpp)
add_source("Math" Basis.cpp)
add_source("Math" Color.cpp)
add_source("Math" Direction.cpp)
add_source("Math" Fixed.cpp)
add_source("Math" Formula.cpp)
add_source("Math" LookupTable.cpp)
add_source("Math" Matrix3.cpp)
add_source("Math" Orientation.cpp)
add_source("Math" Quaternion.cpp)
add_source("Math" Randomizer.cpp)
#add_source("Network" ArenaManager.cpp)
#add_source("Network" ArenaManagerArena.cpp)
add_source("Network" ArenaManagerStub.cpp)
#add_source("Network" BluetoothManager.cpp)
#add_source("Network" BluetoothPowerSwitch.cpp)
add_source("Network" IServerAction.cpp)
#add_source("Network" Message.cpp)
add_source("Network" MessageBase.cpp)
#add_source("Network" MessageManager.cpp)
add_source("Network" SocketAPI.cpp)
add_source("Network/Actions" AcceptChallengeAction.cpp)
add_source("Network/Actions" ChallengeStatusAction.cpp)
add_source("Network/Actions" CreateChallengeAction.cpp)
add_source("Network/Actions" DownloadCharactersAction.cpp)
add_source("Network/Actions" DownloadTurnsAction.cpp)
add_source("Network/Actions" EndGameAction.cpp)
add_source("Network/Actions" FindChallengeAction.cpp)
add_source("Network/Actions" GameUpkeepAction.cpp)
add_source("Network/Actions" NameValidationAction.cpp)
add_source("Network/Actions" ServerConfigAction.cpp)
add_source("Network/Actions" UpdateFriendsList.cpp)
add_source("Network/Actions" UploadCharactersAction.cpp)
add_source("Network/Actions" UploadTurnsAction.cpp)
add_source("Raster" 3dtypes.cpp)
add_source("Raster" RenderContext.cpp)
add_source("Render" 3DModelModule.cpp)
add_source("Render" AnimationModule.cpp)
add_source("Render" AnimationResource.cpp)
add_source("Render" AnimationSetResource.cpp)
add_source("Render" Camera.cpp)
add_source("Render" CustomModule.cpp)
add_source("Render" DecalModule.cpp)
add_source("Render" EmitterRule.cpp)
add_source("Render" GraphicsModule.cpp)
add_source("Render" ImageResource.cpp)
add_source("Render" LineDrawing.cpp)
add_source("Render" ModelResource.cpp)
add_source("Render" PaletteFilterContainer.cpp)
add_source("Render" PaletteResource.cpp)
add_source("Render" ParticleEmitterModule.cpp)
add_source("Render" ParticleModule.cpp)
add_source("Render" RenderEffects.cpp)
add_source("Render" RenderManager.cpp)
add_source("Render" SelectionModule.cpp)
add_source("Render" TerrainModule.cpp)
add_source("Render" TerrainResource.cpp)
add_source("Render" TextureResource.cpp)
add_source("Resource" IResource.cpp)
add_source("Resource" ResourceList.cpp)
add_source("Resource" ResourceManager.cpp)
add_source("SnapStub" SnapPacket.cpp)
add_source("Sound" CallMonitor.cpp)
add_source("Sound" MusicStreamBuffer.cpp)
add_source("Sound" SoundMonitor.cpp)
add_source("Sound" SoundWrap.cpp)
add_source("Sound" audiostreamplayer.cpp)
add_source("Sound" simplemixer.cpp)
add_source("System" DFile.cpp)
add_stub(SystemApp.cpp)
add_source("System" SystemAppUi.cpp)
add_source("System" SystemAppView.cpp)
add_source("System" SystemDocument.cpp)
add_source("System" TKMF.cpp)
add_source("Utility" BB_String.cpp)
add_source("Utility" BitVector.cpp)
add_source("Utility" BlockEncryption.cpp)
add_source("Utility" DebugRef.cpp)
add_source("Utility" IWriteStream.cpp)
add_source("Utility" PerfTimer.cpp)
add_source("Utility" PulseManager.cpp)
add_source("Utility" PulseUser.cpp)
add_source("Utility" RandClass.cpp)
add_source("Utility" ReadStream.cpp)
add_source("Utility" ReadStreamFile.cpp)
add_source("Utility" StateMachine.cpp)
add_source("Utility" SymbianHelpers.cpp)
add_source("Utility" Timer.cpp)
add_source("Utility" WriteStreamFile.cpp)
add_source("Utility" WriteStreamMemory.cpp)
add_source("Utility" df_vsprintf.cpp)
add_source("Utility/zlib" adler32.cpp)
add_source("Utility/zlib" compress.cpp)
add_source("Utility/zlib" crc32.cpp)
add_source("Utility/zlib" deflate.cpp)
add_source("Utility/zlib" infblock.cpp)
add_source("Utility/zlib" infcodes.cpp)
add_source("Utility/zlib" inffast.cpp)
add_source("Utility/zlib" inflate.cpp)
add_source("Utility/zlib" inftrees.cpp)
add_source("Utility/zlib" infutil.cpp)
add_source("Utility/zlib" trees.cpp)
add_source("Utility/zlib" uncompr.cpp)
add_source("Utility/zlib" zutil.cpp)

build_library()
build_dll()
